<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <title>Search Results</title>
</head>
<body>
    <h2>Take a look at these...</h2>
    <div class="results-container">
        <a href="{{ url_for('favorites') }}"><button id="Fav_pa">Favorites</button></a>
        {% for result in results %}
        <div class="result-box">
            <div class="result-favorites-container">
                <div class="add-to-favorites" data-username="{{ result.name }}">
                    <button class="add-to-favorites-button" id="fav-button-{{ result.name }}" data-username="{{ result.name }}" data-image="{{ result.image_url | default('', true) }}" data-description="{{ result.description | default('', true) }}"></button>
                </div>
            </div>
            <a href="https://torre.ai/{{ result.username }}" target="_blank">
                <div class="result-image">
                    {% if result.image_url %}
                    <img src="{{ result.image_url }}" alt="{{ result.name }}">
                    {% endif %}
                </div>
                <div class="result-details">
                    <h3>{{ result.name }} </h3>
                    <p1>{{ result.description }}</p1>
                </div>
            </a>

        </div>
        {% endfor %}
    </div>

    <div class="notification-container"></div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const addToFavoritesButtons = document.querySelectorAll(".add-to-favorites-button");
    
            addToFavoritesButtons.forEach(button => {
                button.addEventListener("click", function () {
                    const username = button.getAttribute("data-username");
                    const image_url = button.getAttribute("data-image");
                    const description = button.getAttribute("data-description");
    
                    addFavorite(username, image_url, description);
                });
            });
        });
    
        function addFavorite(name, image_url, description) {
            fetch(`/add_favorite/${name}?image_url=${image_url}&description=${description}`)
                .then(response => response.json())
                .then(data => {
                    const notificationDiv = document.createElement("div");
                    notificationDiv.innerText = data.message;
                    notificationDiv.className = "notification"; 
    
                    document.body.appendChild(notificationDiv);
    
                    setTimeout(() => {
                        document.body.removeChild(notificationDiv);
                    }, 5000); 
                });
        }
    </script>    
</body>
</html>